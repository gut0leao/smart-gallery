#!/bin/bash
# Script para backup completo do site WordPress
# Salva banco de dados e uploads em diret√≥rio sincronizado (OneDrive)

set -e

if [ ! -d "./backups" ]; then
	echo "‚ö†Ô∏è Diret√≥rio ./backups n√£o encontrado! Execute primeiro o script map_backup_dir para configurar o destino dos backups."
	exit 1
fi

# Caminho do diret√≥rio de backup (ajuste conforme necess√°rio)
BACKUP_DIR="./backups/"

# Cria diret√≥rio se n√£o existir
mkdir -p "$BACKUP_DIR"

BACKUP_DATE="$(date +%Y%m%d-%H%M%S)"
BACKUP_DB="$BACKUP_DIR/${BACKUP_DATE}-db.sql.gz"
BACKUP_UPLOADS="$BACKUP_DIR/${BACKUP_DATE}-uploads.tar.gz"
BACKUP_PLUGINS="$BACKUP_DIR/${BACKUP_DATE}-plugins.tar.gz"
BACKUP_THEMES="$BACKUP_DIR/${BACKUP_DATE}-themes.tar.gz"

echo "üóÑÔ∏è  Exportando banco de dados para $BACKUP_DB ..."
ddev export-db --file="$BACKUP_DB"

echo "üóÇÔ∏è  Compactando uploads para $BACKUP_UPLOADS ..."
tar czf "$BACKUP_UPLOADS" wp-content/uploads

echo "üóÇÔ∏è  Compactando temas para $BACKUP_THEMES ..."
tar czf "$BACKUP_THEMES" wp-content/themes

echo "üóÇÔ∏è  Compactando plugins para $BACKUP_PLUGINS ..."
tar czf "$BACKUP_PLUGINS" wp-content/plugins

echo "‚úÖ Backup conclu√≠do."