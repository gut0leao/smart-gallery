#!/bin/bash

## Description: Launch phpMyAdmin in your browser
## Usage: phpmyadmin
## Example: "ddev phpmyadmin"

if [ ${DDEV_PROJECT_STATUS} != "running" ]; then
  echo "Project ${DDEV_PROJECT} is not running, starting it"
  ddev start
fi

DDEV_PHPMYADMIN_PORT=$(ddev describe -j | docker run -i --rm ddev/ddev-utilities jq -r '.raw.services.dba.host_ports | split(",") | .[0]')
DDEV_PHPMYADMIN_HTTPS_PORT=$(ddev describe -j | docker run -i --rm ddev/ddev-utilities jq -r '.raw.services.dba.host_https_ports | split(",") | .[0]')

if command -v xdg-open >/dev/null 2>&1; then
    xdg-open "http://127.0.0.1:${DDEV_PHPMYADMIN_PORT}"
elif command -v open >/dev/null 2>&1; then
    open "http://127.0.0.1:${DDEV_PHPMYADMIN_PORT}"
else
    echo "phpMyAdmin: http://127.0.0.1:${DDEV_PHPMYADMIN_PORT}"
    echo "Server: db"
    echo "Username: db"  
    echo "Password: db"
    echo "Or use your phpMyAdmin snapshot URL if you have that configured."
fi
