#!/bin/bash
# Script para restaurar backup completo do site WordPress
# Restaura banco de dados, uploads, plugins e temas do diret√≥rio sincronizado (OneDrive)

set -e

if [ ! -d "./backups" ]; then
    echo "‚ö†Ô∏è Diret√≥rio ./backups n√£o encontrado! Execute primeiro o script map_backup_dir para configurar o destino dos backups."
    exit 1
fi

# Caminho do diret√≥rio de backup (ajuste conforme necess√°rio)
BACKUP_DIR="./backups"

# Verifica se a data foi passada como argumento
if [ -z "$1" ]; then
    echo "Uso: $0 <DATA>"
    echo "Exemplo: $0 20250827-153000"
    exit 1
fi
RESTORE_DATE="$1"

# Restaurar banco de dados
BACKUP_DB="$BACKUP_DIR/${RESTORE_DATE}-db.sql.gz"
if [ -f "$BACKUP_DB" ]; then
    echo "Restaurando banco de dados de $BACKUP_DB..."
    ddev import-db --file="$BACKUP_DB"
else
    echo "‚ùå Arquivo de banco de dados n√£o encontrado para a data $RESTORE_DATE."
fi

# Restaurar uploads
BACKUP_UPLOADS="$BACKUP_DIR/${RESTORE_DATE}-uploads.tar.gz"
if [ -f "$BACKUP_UPLOADS" ]; then
    echo "üóÇÔ∏è  Restaurando uploads de $BACKUP_UPLOADS..."
    tar xzf "$BACKUP_UPLOADS" -C wp-content/
else
    echo "‚ùå Arquivo de uploads n√£o encontrado para a data $RESTORE_DATE."
fi

# Restaurar plugins
BACKUP_PLUGINS="$BACKUP_DIR/${RESTORE_DATE}-plugins.tar.gz"
if [ -f "$BACKUP_PLUGINS" ]; then
    echo "üóÇÔ∏è  Restaurando plugins de $BACKUP_PLUGINS..."
    tar xzf "$BACKUP_PLUGINS" -C wp-content/
else
    echo "‚ùå Arquivo de plugins n√£o encontrado para a data $RESTORE_DATE."
fi

# Restaurar temas
BACKUP_THEMES="$BACKUP_DIR/${RESTORE_DATE}-themes.tar.gz"
if [ -f "$BACKUP_THEMES" ]; then
    echo "üóÇÔ∏è  Restaurando temas de $BACKUP_THEMES..."
    tar xzf "$BACKUP_THEMES" -C wp-content/
else
    echo " ‚ùåArquivo de temas n√£o encontrado para a data $RESTORE_DATE."
fi

echo "‚úÖ Restaura√ß√£o conclu√≠da."