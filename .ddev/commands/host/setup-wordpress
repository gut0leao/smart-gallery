#!/biecho "ğŸ” Configurando HTTPS com mkcert..."

# Verificar se estÃ¡ rodando no WSL
if [[ -f /proc/version ]] && grep -q Microsoft /proc/version; then
    echo "ğŸ§ Detectado WSL (Windows Subsystem for Linux)"
    echo "ğŸ“ InstruÃ§Ãµes para WSL:"
    echo "   1. Instale mkcert no WSL: sudo apt install mkcert"
    echo "   2. Instale mkcert no Windows tambÃ©m (via Chocolatey ou GitHub)"
    echo "   3. Execute mkcert -install no WSL E no Windows"
    echo "   4. Certifique-se de que o navegador estÃ¡ rodando no Windows"
    echo ""
fi

# Verificar se mkcert estÃ¡ instalado
if ! command -v mkcert &> /dev/null; then
    echo "âŒ mkcert nÃ£o estÃ¡ instalado."
    if [[ -f /proc/version ]] && grep -q Microsoft /proc/version; then
        echo "   Para WSL, instale com: sudo apt update && sudo apt install mkcert"
        echo "   TambÃ©m instale no Windows: https://github.com/FiloSottile/mkcert"
    else
        echo "   Instale primeiro com: apt install mkcert ou brew install mkcert"
    fi
    exit 1
fi

# Instalar a CA local do mkcert se ainda nÃ£o estiver instalada
echo "ğŸ”‘ Instalando autoridade certificadora local..."
if [[ -f /proc/version ]] && grep -q Microsoft /proc/version; then
    echo "âš ï¸  WSL detectado: ApÃ³s este comando, execute tambÃ©m 'mkcert -install' no Windows!"
fi
mkcert -install 2>/dev/null || trueScript para automatizar a configuraÃ§Ã£o inicial do WordPress

set -e

echo "ï¿½ Configurando HTTPS com mkcert..."
# Verificar se mkcert estÃ¡ instalado
if ! command -v mkcert &> /dev/null; then
    echo "âŒ mkcert nÃ£o estÃ¡ instalado. Instale primeiro com: apt install mkcert ou brew install mkcert"
    exit 1
fi

# Instalar a CA local do mkcert se ainda nÃ£o estiver instalada
mkcert -install 2>/dev/null || true

echo "ğŸ”„ Reiniciando DDEV para aplicar certificados SSL..."
ddev restart

echo "ï¿½ğŸ“¥ Baixando arquivos do WordPress..."
ddev wp core download --force

echo "ğŸ› ï¸  Instalando WordPress..."
ddev wp core install --url="https://smart-gallery-filter.ddev.site" --title="Smart Gallery Filter" --admin_user="admin" --admin_password="admin" --admin_email="admin@local.test"

echo "ğŸ”’ Configurando WordPress para usar HTTPS..."
ddev wp option update home "https://smart-gallery-filter.ddev.site"
ddev wp option update siteurl "https://smart-gallery-filter.ddev.site"

echo "ğŸ”Œ Ativando plugins smart-gallery-filter"
ddev wp plugin activate smart-gallery-filter

echo "ğŸ”ŒğŸ—‘ï¸  Desinstalando plugins: akismet, hello..."
ddev wp plugin uninstall akismet hello

echo "ğŸ”ŒğŸ“¥ Instalando e ativando plugins: elementor, pods"
ddev wp plugin install elementor pods --activate

echo "ğŸ¨ğŸ“¥ Instalando e ativando tema hello-biz"
ddev wp theme install hello-biz --activate

echo "âœ… ConfiguraÃ§Ã£o concluÃ­da! Site disponÃ­vel em:"
echo "ğŸ”— https://smart-gallery-filter.ddev.site"
echo "ğŸ‘¤ Admin: admin / admin"

ddev describe
