name: "üìã Show Infrastructure Info"

on:
  workflow_dispatch:

jobs:
  show-info:
    name: "üìã Display Infrastructure Information"
    runs-on: ubuntu-latest
    
    steps:
      - name: "üìã Infrastructure Information"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "## üèóÔ∏è Current Infrastructure Information" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -n "${{ vars.GCP_VM_INSTANCE }}" ]; then
            echo "### ‚úÖ Active Infrastructure:" >> $GITHUB_STEP_SUMMARY
            echo "- **VM Instance**: \`${{ vars.GCP_VM_INSTANCE }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **Zone**: \`${{ vars.GCP_VM_ZONE }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **External IP**: \`${{ vars.GCP_VM_EXTERNAL_IP }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **Site URL**: ${{ vars.SITE_URL }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Environment**: \`${{ vars.ENVIRONMENT }}\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            if [ "${{ vars.USE_DUCKDNS }}" = "true" ]; then
              echo "### ü¶Ü Duck DNS Status:" >> $GITHUB_STEP_SUMMARY
              echo "‚úÖ **Duck DNS configured automatically**" >> $GITHUB_STEP_SUMMARY
              echo "- **Domain**: \`${{ vars.DUCKDNS_SUBDOMAIN }}.duckdns.org\`" >> $GITHUB_STEP_SUMMARY
              echo "- **Points to**: \`${{ vars.GCP_VM_EXTERNAL_IP }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- **Status**: Active" >> $GITHUB_STEP_SUMMARY
            else
              echo "### üåê DNS Configuration:" >> $GITHUB_STEP_SUMMARY
              echo "Make sure your DNS has an **A Record**:" >> $GITHUB_STEP_SUMMARY
              echo "- **Type**: A Record" >> $GITHUB_STEP_SUMMARY
              echo "- **Name**: Your domain" >> $GITHUB_STEP_SUMMARY
              echo "- **Value**: \`${{ vars.GCP_VM_EXTERNAL_IP }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- **TTL**: 300 (5 minutes)" >> $GITHUB_STEP_SUMMARY
            fi
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### üîß Available Actions:" >> $GITHUB_STEP_SUMMARY
            echo "- **Configure Environment**: Use stored VM details" >> $GITHUB_STEP_SUMMARY
            echo "- **Deploy Plugin**: Use stored VM details" >> $GITHUB_STEP_SUMMARY
          else
            echo "### ‚ö†Ô∏è No Infrastructure Found:" >> $GITHUB_STEP_SUMMARY
            echo "Run the **Provision Infrastructure** workflow first." >> $GITHUB_STEP_SUMMARY
          fi
          
          echo ""
          echo "üèóÔ∏è Current Infrastructure Status:"
          echo "VM Instance: ${{ vars.GCP_VM_INSTANCE || 'Not provisioned' }}"
          echo "Zone: ${{ vars.GCP_VM_ZONE || 'Not set' }}"
          echo "External IP: ${{ vars.GCP_VM_EXTERNAL_IP || 'Not assigned' }}"
          echo "Site URL: ${{ vars.SITE_URL || 'Not configured' }}"
          echo "Environment: ${{ vars.ENVIRONMENT || 'Not set' }}"