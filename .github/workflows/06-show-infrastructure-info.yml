name: "6. Show Infrastructure Info üìã"

on:
  workflow_dispatch:

jobs:
  show-info:
    name: "üìã Display Infrastructure Information"
    runs-on: ubuntu-latest
    
    steps:
      - name: "üìã Infrastructure Information"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "## üèóÔ∏è Current Infrastructure Information" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -n "${{ vars.GCP_VM_INSTANCE }}" ]; then
            echo "### ‚úÖ Active Infrastructure:" >> $GITHUB_STEP_SUMMARY
            echo "- **VM Instance**: \`${{ vars.GCP_VM_INSTANCE }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **Zone**: \`${{ vars.GCP_VM_ZONE }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **External IP**: \`${{ vars.GCP_VM_EXTERNAL_IP }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **Site URL**: ${{ vars.SITE_URL }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Environment**: \`${{ vars.ENVIRONMENT }}\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            echo "### üóÑÔ∏è Database Information:" >> $GITHUB_STEP_SUMMARY
            if [ -n "${{ vars.WP_DB_NAME }}" ]; then
              echo "‚úÖ **Database configured**" >> $GITHUB_STEP_SUMMARY
              echo "- **Database Name**: \`${{ vars.WP_DB_NAME }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- **Database User**: \`${{ vars.WP_DB_USER }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- **Password**: ${{ secrets.WP_DB_PASSWORD && 'Stored securely' || 'Not set' }}" >> $GITHUB_STEP_SUMMARY
            else
              echo "‚ö†Ô∏è **Database not configured**" >> $GITHUB_STEP_SUMMARY
              echo "Run the **Install Packages** workflow to set up the database." >> $GITHUB_STEP_SUMMARY
            fi
            echo "" >> $GITHUB_STEP_SUMMARY
            
            if [ "${{ vars.USE_DUCKDNS }}" = "true" ]; then
              echo "### ü¶Ü Duck DNS Status:" >> $GITHUB_STEP_SUMMARY
              echo "‚úÖ **Duck DNS configured automatically**" >> $GITHUB_STEP_SUMMARY
              echo "- **Domain**: \`${{ vars.DUCKDNS_SUBDOMAIN }}.duckdns.org\`" >> $GITHUB_STEP_SUMMARY
              echo "- **Points to**: \`${{ vars.GCP_VM_EXTERNAL_IP }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- **Status**: Active" >> $GITHUB_STEP_SUMMARY
            else
              echo "### üåê DNS Configuration:" >> $GITHUB_STEP_SUMMARY
              echo "Make sure your DNS has an **A Record**:" >> $GITHUB_STEP_SUMMARY
              echo "- **Type**: A Record" >> $GITHUB_STEP_SUMMARY
              echo "- **Name**: Your domain" >> $GITHUB_STEP_SUMMARY
              echo "- **Value**: \`${{ vars.GCP_VM_EXTERNAL_IP }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- **TTL**: 300 (5 minutes)" >> $GITHUB_STEP_SUMMARY
            fi
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ÔøΩ Required Secrets Status:" >> $GITHUB_STEP_SUMMARY
            echo "- **GCP_SA_KEY**: ${{ secrets.GCP_SA_KEY && '‚úÖ Set' || '‚ùå Not set' }}" >> $GITHUB_STEP_SUMMARY
            echo "- **GITHUB_TOKEN**: ${{ secrets.GITHUB_TOKEN && '‚úÖ Set' || '‚ùå Not set' }}" >> $GITHUB_STEP_SUMMARY
            echo "- **DUCKDNS_TOKEN**: ${{ secrets.DUCKDNS_TOKEN && '‚úÖ Set' || '‚ùå Not set' }}" >> $GITHUB_STEP_SUMMARY
            echo "- **WP_DB_PASSWORD**: ${{ secrets.WP_DB_PASSWORD && '‚úÖ Set' || '‚ùå Not set' }}" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ÔøΩüîß Available Actions:" >> $GITHUB_STEP_SUMMARY
            echo "- **Configure Environment**: Use stored VM and DB details" >> $GITHUB_STEP_SUMMARY
            echo "- **Deploy Plugin**: Use stored VM and DB details" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### üõ†Ô∏è Usage Examples:" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**Access database in workflows:**" >> $GITHUB_STEP_SUMMARY
            echo '```yaml' >> $GITHUB_STEP_SUMMARY
            echo 'env:' >> $GITHUB_STEP_SUMMARY
            echo '  DB_NAME: ${{ vars.WP_DB_NAME }}' >> $GITHUB_STEP_SUMMARY
            echo '  DB_USER: ${{ vars.WP_DB_USER }}' >> $GITHUB_STEP_SUMMARY
            echo '  DB_PASS: ${{ secrets.WP_DB_PASSWORD }}' >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "### ‚ö†Ô∏è No Infrastructure Found:" >> $GITHUB_STEP_SUMMARY
            echo "Run the **Provision Infrastructure** workflow first." >> $GITHUB_STEP_SUMMARY
          fi
          
          echo ""
          echo "üèóÔ∏è Current Infrastructure Status:"
          echo "VM Instance: ${{ vars.GCP_VM_INSTANCE || 'Not provisioned' }}"
          echo "Zone: ${{ vars.GCP_VM_ZONE || 'Not set' }}"
          echo "External IP: ${{ vars.GCP_VM_EXTERNAL_IP || 'Not assigned' }}"
          echo "Site URL: ${{ vars.SITE_URL || 'Not configured' }}"
          echo "Environment: ${{ vars.ENVIRONMENT || 'Not set' }}"
          echo ""
          echo "üóÑÔ∏è Database Status:"
          echo "Database Name: ${{ vars.WP_DB_NAME || 'Not configured' }}"
          echo "Database User: ${{ vars.WP_DB_USER || 'Not configured' }}"
          echo "Database Password: ${{ secrets.WP_DB_PASSWORD && 'Stored securely' || 'Not set' }}"